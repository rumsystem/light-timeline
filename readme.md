# NFT BBS

## Frontend
```bash
yarn install
yarn start
```

## Server
```bash
cd server
yarn install
yarn start
yarn dev # 带有 watch 功能
yarn reset # 清空所有缓存数据，比如 Database 和 LocalStorage
```

## Server 相关常见问题

### 为什么需要有一个 Server？
让我们看看没有 Server 所带来的问题：
1. 每一个用户都需要在前端浏览器，把所有的数据获取一遍，然后灌到 indexdb 里面
2. 随着时间的推移，数据量只会越来越大，用户等待灌数据的时间会越来越长
3. 某个用户通过一篇文章的链接过来，只是想看这篇文章，但却需要把全部的数据加载一遍
4. 对于移动端使用流量的用户来说，几十M，上百M的数据量，是非常浪费的

综上所述，让用户自己在浏览器里面灌数据，是不合理的，体验差的，也是不可持续的。
P2P 去中心化的功能是全节点的事情。对于轻节点来说，还让用户自己在浏览器灌一遍数据的，意义何在？对吧，完全没有必要的，轻节点永远是把体验放在第一位，就好了。所以我们需要一个 Server，灌数据由这个后端来说，它灌一遍，建立好索引，然后提供 API 来服务用户。

### 这个 Server 有什么功能？
把一个 group 的内容获取下来，灌到数据里面，并且把索引建立好，方便查询。

### 可以给 Server 提交数据吗？
不可以，Server 是只读的，提交数据直接用 SDK 给全节点发送 trx

### Server 如何推送内容？会推送哪些内容？
每个用户通过 socket 和 Server 建立联系。Server 会通知如下内容：

1. `content`，每收到一条 content，就推送一条，方便 frontend 把内容状态标记为已同步
2. `notification`，和当前用户有关系的消息通知，点赞、评论等等

### Server 如果出问题了，如何重置？
运行 `cd server && yarn reset`，把 `Database` 和 `LocalStorage` 都清除掉，一切重新开始。

做这个动作不用有负担，因为所有的数据都是从链上读回来的，所以你不会弄丢任何数据的。

副作用只是重新灌数据的这段时间里面，用户没法访问到数据而已。

### 灌数据的时候，会推送消息吗？
不会的，在首次灌数据的过程中，不会推送任何消息，等灌完，之后新来的数据，才会推送消息。

这样可以避免灌数据的时候，推送大量的内容。而且对于未读消息，用户明明已经读过了，但重新灌一遍数据，就又变成未读了，这样体验不好。

### 如何查看灌数据的日志状态？
查看 `server/localStorage/pollingLogs`

### 如果一条 trx 处理失败了，会影响灌数据的过程吗？
不会，为了让服务更稳定的运行，我们只记录错误信息到 `Server/localStorage/pollingLogs`，然后跳过它，继续处理后面的数据

### 将来上线的时候，数据库打算使用本地的，还是远程的？
因为灌到数据库的内容都是临时的，不重要的，可以随时删除重置的。所以这个问题不重要，怎么方便怎么来。

### 如何新增一个表？
1. `server/database/sequelize/` 定义表的结构
2. `server/reset.js` 把表的清理工作，也补充一下，这样才能 reset
3. `server/` 编写表的查询方法
4. `server/routes/` 编写表的 API 路由
5. `server/index.js` 把这个表的路由，使用 `router.use` 集成到 Server 里面
6. 完毕